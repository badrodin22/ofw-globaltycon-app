<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0f0f1b; color: white; font-family: 'Orbitron', sans-serif; margin: 0; overflow: hidden; text-transform: uppercase; }
        .arena { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: url('https://wallpaperaccess.com/full/1267160.jpg') center/cover; }
        
        .battle-field { display: flex; width: 100%; justify-content: space-around; align-items: center; margin-bottom: 50px; }
        
        /* Splinterlands Card Style */
        .card { width: 130px; height: 190px; border: 4px solid #444; border-radius: 10px; position: relative; background: #222; transition: 0.3s; box-shadow: 0 0 15px rgba(0,0,0,0.8); }
        .card.active { border-color: #00ff00; transform: scale(1.1); box-shadow: 0 0 20px #00ff00; }
        .card.hit { animation: hit 0.3s; }
        
        .hp-bar { width: 100%; height: 10px; background: #550000; position: absolute; top: -20px; border-radius: 5px; overflow: hidden; }
        .hp-fill { height: 100%; background: #ff0000; transition: 0.5s; }
        
        .stats { position: absolute; bottom: 5px; width: 100%; display: flex; justify-content: space-around; font-size: 12px; font-weight: bold; }
        .stat { background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 3px; }
        
        #log { height: 100px; width: 90%; background: rgba(0,0,0,0.6); border: 1px solid #444; padding: 10px; overflow-y: auto; font-size: 12px; color: #aaa; }
        
        @keyframes hit { 0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 100% { transform: translateX(0); } }
        
        .btn-start { background: #e67e22; border: none; padding: 15px 30px; color: white; font-weight: bold; border-radius: 5px; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="arena">
        <div class="battle-field">
            <div id="card1" class="card">
                <div class="hp-bar"><div id="hp1" class="hp-fill" style="width: 100%;"></div></div>
                <div id="n1" style="padding-top: 50px; font-size: 14px;">CARD 1</div>
                <div class="stats">
                    <div class="stat" style="color: #ff4d4d;">‚öîÔ∏è 5</div>
                    <div class="stat" style="color: #4da6ff;">üõ°Ô∏è 2</div>
                </div>
            </div>

            <div style="font-size: 24px; font-weight: bold; color: gold;">VS</div>

            <div id="card2" class="card">
                <div class="hp-bar"><div id="hp2" class="hp-fill" style="width: 100%;"></div></div>
                <div id="n2" style="padding-top: 50px; font-size: 14px;">CARD 2</div>
                <div class="stats">
                    <div class="stat" style="color: #ff4d4d;">‚öîÔ∏è 4</div>
                    <div class="stat" style="color: #4da6ff;">üõ°Ô∏è 3</div>
                </div>
            </div>
        </div>

        <div id="log">READY FOR BATTLE...</div>
        <button id="fight-btn" class="btn-start" onclick="processBattle()">AUTO BATTLE</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('n1').innerText = urlParams.get('p1') || "HERO";
        document.getElementById('n2').innerText = urlParams.get('p2') || "MONSTER";

        let h1 = 100, h2 = 100;

        function addLog(text) {
            const log = document.getElementById('log');
            log.innerHTML += `<div>> ${text}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        async function processBattle() {
            document.getElementById('fight-btn').style.display = 'none';
            addLog("BATTLE STARTED!");

            while (h1 > 0 && h2 > 0) {
                // Turn Player 1
                await attack('card1', 'card2', 20);
                h2 -= 20;
                updateBars();
                if (h2 <= 0) break;

                // Turn Player 2
                await new Promise(r => setTimeout(r, 800));
                await attack('card2', 'card1', 15);
                h1 -= 15;
                updateBars();
            }

            addLog(h1 > 0 ? "PLAYER 1 WINS!" : "PLAYER 2 WINS!");
            setTimeout(() => { tg.close(); }, 3000);
        }

        function updateBars() {
            document.getElementById('hp1').style.width = h1 + "%";
            document.getElementById('hp2').style.width = h2 + "%";
        }

        function attack(attackerId, targetId, damage) {
            return new Promise(resolve => {
                const attacker = document.getElementById(attackerId);
                const target = document.getElementById(targetId);
                attacker.classList.add('active');
                
                setTimeout(() => {
                    target.classList.add('hit');
                    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
                    addLog(`DEALT ${damage} DAMAGE`);
                    setTimeout(() => {
                        attacker.classList.remove('active');
                        target.classList.remove('hit');
                        resolve();
                    }, 300);
                }, 400);
            });
        }
    </script>
</body>
</html>
