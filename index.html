<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0b0b14; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; }
        .arena { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #222, #000); }
        
        .battle-field { display: flex; width: 100%; justify-content: space-around; align-items: center; margin-bottom: 30px; }
        
        /* Splinterlands Card Style */
        .card { width: 140px; height: 200px; border: 4px solid #gold; border-radius: 15px; position: relative; background: #222; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: 0.3s; }
        .card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .card.active { transform: scale(1.1) translateY(-10px); border-color: #00ff00; box-shadow: 0 0 30px #00ff00; }
        .card.hit { animation: shake 0.3s; border-color: #ff0000; }
        
        .hp-bar { width: 90%; height: 10px; background: #444; position: absolute; top: 10px; left: 5%; border-radius: 5px; z-index: 10; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #ff0000, #ff6666); width: 100%; transition: 0.4s; }
        
        .name-tag { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); padding: 5px 0; font-size: 12px; font-weight: bold; text-align: center; color: gold; }

        #log { width: 85%; height: 80px; background: rgba(0,0,0,0.5); border-radius: 10px; padding: 10px; font-size: 11px; overflow-y: auto; color: #ccc; border: 1px solid #333; }
        
        .btn-fight { margin-top: 20px; padding: 15px 40px; background: linear-gradient(#ff8c00, #ff4500); border: none; border-radius: 50px; color: white; font-weight: bold; font-size: 18px; box-shadow: 0 5px 15px rgba(255,69,0,0.4); cursor: pointer; }

        @keyframes shake { 0% { transform: translate(5px, 0); } 50% { transform: translate(-5px, 0); } 100% { transform: translate(0, 0); } }
    </style>
</head>
<body>
    <div class="arena">
        <div class="battle-field">
            <div id="card1" class="card">
                <div class="hp-bar"><div id="hp1" class="hp-fill"></div></div>
                <img id="img1" src="" onerror="this.src='https://via.placeholder.com/140x200?text=NBA+PLAYER'">
                <div class="name-tag" id="n1">PLAYER 1</div>
            </div>
            <div style="font-weight: bold; color: gold; font-size: 20px;">VS</div>
            <div id="card2" class="card">
                <div class="hp-bar"><div id="hp2" class="hp-fill"></div></div>
                <img id="img2" src="" onerror="this.src='https://via.placeholder.com/140x200?text=NBA+PLAYER'">
                <div class="name-tag" id="n2">PLAYER 2</div>
            </div>
        </div>
        <div id="log">> STANDBY FOR CLASH...</div>
        <button id="fight-btn" class="btn-fight" onclick="startBattle()">START AUTO-BATTLE</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const urlParams = new URLSearchParams(window.location.search);
        const p1Name = urlParams.get('p1') || "Hero";
        const p2Name = urlParams.get('p2') || "Enemy";

        document.getElementById('n1').innerText = p1Name;
        document.getElementById('n2').innerText = p2Name;

        // Load Images (Dapat may images ka sa GitHub na kapangalan ng Player)
        document.getElementById('img1').src = p1Name.toLowerCase() + ".png";
        document.getElementById('img2').src = p2Name.toLowerCase() + ".png";

        let h1 = 100, h2 = 100;

        async function startBattle() {
            document.getElementById('fight-btn').style.display = 'none';
            const log = document.getElementById('log');
            
            while(h1 > 0 && h2 > 0) {
                // Player 1 Attacks
                await playAction('card1', 'card2', 20);
                h2 -= 20;
                document.getElementById('hp2').style.width = h2 + "%";
                log.innerHTML += `<div>> ${p1Name} hits for 20 DMG!</div>`;
                if(h2 <= 0) break;

                await new Promise(r => setTimeout(r, 600));

                // Player 2 Attacks
                await playAction('card2', 'card1', 15);
                h1 -= 15;
                document.getElementById('hp1').style.width = h1 + "%";
                log.innerHTML += `<div>> ${p2Name} counters for 15 DMG!</div>`;
            }

            log.innerHTML += `<div style="color:gold">> BATTLE ENDED!</div>`;
            setTimeout(() => { tg.close(); }, 2500);
        }

        function playAction(atkId, defId, dmg) {
            return new Promise(resolve => {
                document.getElementById(atkId).classList.add('active');
                setTimeout(() => {
                    document.getElementById(defId).classList.add('hit');
                    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
                    setTimeout(() => {
                        document.getElementById(atkId).classList.remove('active');
                        document.getElementById(defId).classList.remove('hit');
                        resolve();
                    }, 200);
                }, 300);
            });
        }
    </script>
</body>
</html>
