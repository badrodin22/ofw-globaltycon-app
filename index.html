<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OFW Global Tycoon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #00f2ff; /* Neon Cyan */
            --accent: #fbbf24; /* Gold */
            --bg: #05070a; 
            --card: rgba(255, 255, 255, 0.08); 
        }

        body { 
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://images.unsplash.com/photo-1614850523296-d8c1af93d400?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            color: #fff;
            font-family: 'Poppins', sans-serif;
            margin: 0; padding: 0;
            text-align: center;
            overflow: hidden;
            height: 100vh;
        }

        /* Top Bar */
        .top-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px;
            background: rgba(0,0,0,0.6);
        }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--primary); background: #1e293b; }

        /* Stats & Level Bar */
        .main-stats { margin-top: 10px; }
        .balance { font-size: 3rem; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--primary); }
        
        .level-container { width: 80%; margin: 10px auto; text-align: left; font-size: 0.7rem; }
        .level-bar-bg { width: 100%; height: 6px; background: #334155; border-radius: 10px; margin-top: 5px; overflow: hidden; }
        .level-bar-fill { height: 100%; width: 30%; background: linear-gradient(90deg, var(--primary), #a855f7); }

        .sub-stats { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .stat-card { background: var(--card); padding: 10px 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); flex: 1; max-width: 130px; }
        .stat-card small { display: block; font-size: 0.6rem; color: #94a3b8; }
        .stat-card b { color: var(--primary); font-size: 0.9rem; }

        /* Main Character Area */
        .game-area { height: 40vh; display: flex; align-items: center; justify-content: center; position: relative; }
        .main-img { 
            width: 220px; cursor: pointer; transition: transform 0.05s;
            filter: drop-shadow(0 0 40px rgba(0,242,255,0.4));
        }
        .main-img:active { transform: scale(0.92); }

        /* Welcome Popup */
        #welcome-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
        .popup-card {
            background: #111827; width: 80%; padding: 40px 20px; border-radius: 30px; 
            border: 1px solid var(--primary); text-align: center;
        }
        .claim-btn {
            background: #fff; color: #000; border: none; padding: 15px; width: 100%;
            border-radius: 50px; font-weight: 900; margin-top: 20px; cursor: pointer;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: #0a0f18;
            padding: 15px 10px 30px 10px; border-radius: 25px 25px 0 0; box-sizing: border-box;
        }
        .energy-box { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding: 0 10px; }
        .energy-bar-bg { flex: 1; height: 12px; background: #1e293b; border-radius: 20px; overflow: hidden; }
        .energy-bar-fill { height: 100%; width: 100%; background: var(--accent); transition: width 0.3s; }

        .menu-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .menu-btn { font-size: 0.65rem; color: #64748b; cursor: pointer; }
        .menu-btn span { display: block; font-size: 1.4rem; margin-bottom: 3px; filter: grayscale(1); }
        .menu-btn.active { color: #fff; }
        .menu-btn.active span { filter: grayscale(0); }

        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="welcome-overlay">
        <div class="popup-card">
            <h2 style="margin:0;">Welcome Back!</h2>
            <p style="color: #94a3b8; font-size: 0.8rem;">Passive income collected while you were away:</p>
            <div style="font-size: 2.2rem; font-weight: 900; color: var(--accent); margin: 15px 0;">
                ‚ùÑÔ∏è <span id="offline-amt">0</span>
            </div>
            <button class="claim-btn" onclick="claimRewards()">CLAIM</button>
        </div>
    </div>

    <div class="top-nav">
        <div class="user-info">
            <div class="user-avatar"></div>
            <div style="text-align: left;">
                <div id="username" style="font-weight: 900; font-size: 0.8rem;">PLAYER</div>
                <div style="font-size: 0.6rem; color: var(--primary);">LVL 6 - GREEN DRAGON</div>
            </div>
        </div>
        <div style="background: var(--card); padding: 5px 12px; border-radius: 15px; font-size: 0.7rem; border: 1px solid var(--primary);">üíé 0 +</div>
    </div>

    <div class="main-stats">
        <div class="balance">‚ùÑÔ∏è <span id="balance">0</span></div>
        <div class="level-container">
            <div style="display:flex; justify-content:space-between"><span>Level 6/12</span><span>1.3M/5M</span></div>
            <div class="level-bar-bg"><div class="level-bar-fill"></div></div>
        </div>
        <div class="sub-stats">
            <div class="stat-card"><small>per tap</small><b id="ppc-text">+10</b></div>
            <div class="stat-card"><small>per hour</small><b id="pps-text">+0</b></div>
        </div>
    </div>

    <div class="game-area">
        <img src="https://cdn-icons-png.flaticon.com/512/3753/3753443.png" class="main-img" onclick="tap(event)">
    </div>

    <div class="bottom-nav">
        <div class="energy-box">
            <span style="font-weight: 900; font-size: 0.8rem;">‚ö° <span id="energy-num">1000</span></span>
            <div class="energy-bar-bg"><div class="energy-bar-fill" id="energy-bar"></div></div>
            <button style="background: #10b981; border:none; color:#fff; padding: 5px 10px; border-radius:10px; font-size:0.7rem; font-weight:bold;">UPGRADE</button>
        </div>
        <div class="menu-grid">
            <div class="menu-btn active"><span>üêâ</span>Dragon</div>
            <div class="menu-btn"><span>üìã</span>Tasks</div>
            <div class="menu-btn"><span>‚öîÔ∏è</span>Battle</div>
            <div class="menu-btn"><span>üÉè</span>Cards</div>
            <div class="menu-btn"><span>üèÜ</span>Ranks</div>
        </div>
    </div>

    <script>
        let tele = window.Telegram.WebApp;
        tele.expand();
        document.getElementById('username').innerText = (tele.initDataUnsafe.user?.first_name || "PLAYER").toUpperCase();

        let balance = parseFloat(localStorage.getItem('ofw_bal')) || 0;
        let pps = parseFloat(localStorage.getItem('ofw_pps')) || 0; 
        let energy = 1000;
        let lastLog = localStorage.getItem('ofw_time') || Date.now();

        // Welcome back logic
        window.onload = () => {
            let diff = Math.floor((Date.now() - lastLog) / 1000);
            if (diff > 30 && pps > 0) {
                let offEarn = (pps / 3600) * diff;
                document.getElementById('offline-amt').innerText = Math.floor(offEarn).toLocaleString();
                document.getElementById('welcome-overlay').style.display = 'flex';
                window.pending = offEarn;
            }
            update();
        };

        function claimRewards() {
            balance += window.pending;
            document.getElementById('welcome-overlay').style.display = 'none';
            save(); update();
        }

        function tap(e) {
            if (energy >= 1) {
                balance += 10; energy -= 1;
                spawn(e); update(); save();
                tele.HapticFeedback.impactOccurred('medium');
            }
        }

        function spawn(e) {
            const t = document.createElement('div');
            t.innerText = "+10";
            t.style.cssText = `position:absolute; left:${e.pageX}px; top:${e.pageY}px; color:var(--primary); font-weight:900; animation:floatUp 0.6s forwards; pointer-events:none;`;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 600);
        }

        setInterval(() => { if(pps>0){ balance+=(pps/3600); update(); save(); } }, 1000);
        setInterval(() => { if(energy<1000){ energy+=2; update(); } }, 1000);

        function save() {
            localStorage.setItem('ofw_bal', balance);
            localStorage.setItem('ofw_pps', pps);
            localStorage.setItem('ofw_time', Date.now());
        }

        function update() {
            document.getElementById('balance').innerText = Math.floor(balance).toLocaleString();
            document.getElementById('pps-text').innerText = "+" + Math.floor(pps).toLocaleString();
            document.getElementById('energy-num').innerText = energy;
            document.getElementById('energy-bar').style.width = (energy/10) + "%";
        }
    </script>
</body>
</html>
